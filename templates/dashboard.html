{% extends 'base.html' %}
{% block content %}

<div class="container mt-4">
  <h3 class="mb-4">üìä B√°o c√°o t·ªïng quan kho h√†ng</h3>

  <!-- Th·ªëng k√™ t·ªïng quan -->
  <div class="row g-3">
    <div class="col-md-3">
      <div class="card bg-primary text-white shadow p-3 rounded-3">
        <h6>T·ªïng s·∫£n ph·∫©m</h6>
        <h2>{{ total_products }}</h2>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white shadow p-3 rounded-3">
        <h6>Nh√† cung c·∫•p</h6>
        <h2>{{ total_suppliers }}</h2>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white shadow p-3 rounded-3">
        <h6>T·ªïng t·ªìn kho</h6>
        <h2>{{ total_inventory }}</h2>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white shadow p-3 rounded-3">
        <h6>Gi√° tr·ªã t·ªìn kho</h6>
        <h2>{{ inventory_value|floatformat:0 }} ‚Ç´</h2>
      </div>
    </div>
  </div>

  <!-- B·∫£ng top s·∫£n ph·∫©m v√† s·∫£n ph·∫©m s·∫Øp h·∫øt -->
  <div class="row mt-5">
    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="fw-bold mb-3">üî• Top s·∫£n ph·∫©m t·ªìn kho</h6>
          <table class="table table-striped table-sm align-middle">
            <thead>
              <tr class="table-primary">
                <th>T√™n s·∫£n ph·∫©m</th>
                <th>T·ªìn kho</th>
              </tr>
            </thead>
            <tbody>
              {% for sp in top_products %}
              <tr>
                <td>{{ sp.san_pham__ten_san_pham }}</td>
                <td>{{ sp.tong_ton }}</td>
              </tr>
              {% empty %}
              <tr><td colspan="2">Kh√¥ng c√≥ d·ªØ li·ªáu</td></tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="card shadow-sm">
        <div class="card-body">
          <h6 class="fw-bold mb-3">‚ö†Ô∏è S·∫£n ph·∫©m s·∫Øp h·∫øt h√†ng</h6>
          {% if low_stock %}
          <ul class="list-group">
            {% for sp in low_stock %}
              <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ sp.san_pham.ten_san_pham }}
                <span class="badge bg-danger">{{ sp.so_luong_ton }}</span>
              </li>
            {% endfor %}
          </ul>
          {% else %}
          <p>‚úÖ Kh√¥ng c√≥ s·∫£n ph·∫©m n√†o s·∫Øp h·∫øt h√†ng</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- Bi·ªÉu ƒë·ªì nh·∫≠p ‚Äì xu·∫•t -->
  <div class="card shadow-sm mt-5">
    <div class="card-body">
      <h6 class="fw-bold mb-3">üìà Bi·ªÉu ƒë·ªì nh·∫≠p ‚Äì xu·∫•t kho theo th√°ng</h6>
      <canvas id="importExportChart" height="100"></canvas>
    </div>
  </div>

  <!-- Bi·ªÉu ƒë·ªì c√¥ng n·ª£ nh√† cung c·∫•p -->
  <div class="card shadow-sm mt-5 mb-5">
    <div class="card-body">
      <h6 class="fw-bold mb-3">üí∞ Bi·ªÉu ƒë·ªì c√¥ng n·ª£ nh√† cung c·∫•p</h6>
      <canvas id="debtChart" height="100"></canvas>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  // --- Bi·ªÉu ƒë·ªì Nh·∫≠p ‚Äì Xu·∫•t ---
  const ctx1 = document.getElementById('importExportChart');
  new Chart(ctx1, {
    type: 'bar',
    data: {
      labels: {{ labels|safe }},
      datasets: [
        {
          label: 'Nh·∫≠p kho',
          data: {{ import_data|safe }},
          backgroundColor: 'rgba(54, 162, 235, 0.6)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        },
        {
          label: 'Xu·∫•t kho',
          data: {{ export_data|safe }},
          backgroundColor: 'rgba(255, 99, 132, 0.6)',
          borderColor: 'rgba(255, 99, 132, 1)',
          borderWidth: 1
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: { beginAtZero: true }
      },
      plugins: {
        legend: { position: 'bottom' }
      }
    }
  });

  // --- Bi·ªÉu ƒë·ªì c√¥ng n·ª£ nh√† cung c·∫•p ---
  const ctx2 = document.getElementById('debtChart');
  new Chart(ctx2, {
    type: 'bar',
    data: {
      labels: {{ debt_labels|safe }},
      datasets: [{
        label: 'C√¥ng n·ª£ (VNƒê)',
        data: {{ debt_values|safe }},
        backgroundColor: [
          'rgba(255, 99, 132, 0.7)',
          'rgba(54, 162, 235, 0.7)',
          'rgba(255, 206, 86, 0.7)',
          'rgba(75, 192, 192, 0.7)',
          'rgba(153, 102, 255, 0.7)'
        ],
        borderColor: 'rgba(255,255,255,0.8)',
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
        title: { display: true, text: 'Top 5 nh√† cung c·∫•p c√≥ c√¥ng n·ª£ cao nh·∫•t' }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>

{% endblock %}
