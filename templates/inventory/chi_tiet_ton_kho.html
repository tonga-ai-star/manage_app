{% extends 'base.html' %}
{% block title %}Chi tiết tồn kho{% endblock %}

{% block page_title %}Chi tiết Tồn Kho{% endblock %}

{% block content %}
<div class="card shadow-sm rounded-4 p-4">
    <h5 class="card-title mb-4 fw-bold">Chi tiết tồn kho</h5>

    <!-- Filter -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-4">
            <label for="kho" class="form-label fw-semibold">Chọn kho</label>
            <select id="kho" name="kho" class="form-select">
                <option value="">Tất cả kho</option>
                {% for k in danh_sach_kho %}
                    <option value="{{ k.id }}" {% if selected_kho == k.id|stringformat:"s" %}selected{% endif %}>{{ k.ten_kho }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4">
            <label for="san_pham" class="form-label fw-semibold">Chọn sản phẩm</label>
            <select id="san_pham" name="san_pham" class="form-select">
                <option value="">Tất cả sản phẩm</option>
                {% for sp in danh_sach_san_pham %}
                    <option value="{{ sp.id }}" {% if selected_san_pham == sp.id|stringformat:"s" %}selected{% endif %}>{{ sp.ten_san_pham }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="col-md-4 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Lọc</button>
        </div>
    </form>

    <!-- Bảng tồn kho -->
    <div class="table-responsive shadow-sm rounded-3">
        <table class="table table-striped table-hover align-middle mb-0">
            <thead class="table-dark text-center">
                <tr>
                    <th>Mã SP</th>
                    <th>Tên sản phẩm</th>
                    <th>Danh mục</th>
                    <th>Đơn vị tính</th>
                    <th>Số lượng tồn</th>
                    <th>Số lượng khả dụng</th>
                    <th>Kho</th>
                    <th>Trạng thái</th>
                </tr>
            </thead>
            <tbody>
                {% for item in ton_kho %}
                <tr>
                    <td class="text-center">{{ item.san_pham.ma_san_pham }}</td>
                    <td>{{ item.san_pham.ten_san_pham }}</td>
                    <td>{{ item.san_pham.danh_muc.ten_danh_muc }}</td>
                    <td class="text-center">{{ item.san_pham.don_vi_tinh.ten_don_vi }}</td>
                    <td class="text-end fw-bold">{{ item.so_luong_ton }}</td>
                    <td class="text-end fw-bold">{{ item.so_luong_kha_dung }}</td>
                    <td>{{ item.kho.ten_kho }}</td>
                    <td class="text-center">
                        {% if item.san_pham.trang_thai == 'Đang hoạt động' %}
                            <span class="badge bg-success">{{ item.san_pham.trang_thai }}</span>
                        {% else %}
                            <span class="badge bg-secondary">{{ item.san_pham.trang_thai }}</span>
                        {% endif %}
                    </td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8" class="text-center text-muted">Chưa có dữ liệu tồn kho</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
